function GradientReader(t){let e,o=document.createElement("canvas"),r=o.getContext("2d"),n=r.createLinearGradient(101,0,0,0),l=0;for(o.width=101,o.height=1;e=t[l++];)stop=parseFloat(e.offset)/100,n.addColorStop(stop,e.color);r.fillStyle=n,r.fillRect(0,0,101,1),this.getColor=function(t){const e=r.getImageData(0|t,0,1,1).data;return fullColorHex(e[0],e[1],e[2])}}function rgbToHex(t){let e=Number(t).toString(16);return e.length<2&&(e="0"+e),e}function fullColorHex(t,e,o){const r=rgbToHex(t),n=rgbToHex(e),l=rgbToHex(o);return r+n+l}BTC={id:33,name:"Bitcoin",symbol:"BTC",color:"#F7931A",short_symbol:"\u20bf",decimals:8,display_decimals:8,show_fiat_decimals:!1},ETH={id:34,name:"Ethereum",symbol:"ETH",color:"#6F7EDA",short_symbol:"\u039e",decimals:18,display_decimals:8,show_fiat_decimals:!1},DAI={id:1e3,name:"Dai",symbol:"DAI",color:"#F4B731",short_symbol:"DAI",decimals:18,display_decimals:8,show_fiat_decimals:!0},BAT={id:1001,name:"Basic Attention",symbol:"BAT",color:"#FF5000",short_symbol:"BAT",decimals:18,display_decimals:8,show_fiat_decimals:!0},KNC={id:1002,name:"Kyber",symbol:"KNC",color:"#31CB9E",short_symbol:"KNC",decimals:18,display_decimals:8,show_fiat_decimals:!0},OMG={id:1003,name:"OMG Network",symbol:"OMG",color:"#101010",short_symbol:"OMG",decimals:18,display_decimals:8,show_fiat_decimals:!0},ZRX={id:1004,name:"0x",symbol:"ZRX",color:"#302C2C",short_symbol:"ZRX",decimals:18,display_decimals:8,show_fiat_decimals:!0},AAVE={id:1005,name:"Aave",symbol:"AAVE",color:"#2EBAC6",short_symbol:"AAVE",decimals:18,display_decimals:8,show_fiat_decimals:!0},ANKR={id:1006,name:"Ankr",symbol:"ANKR",color:"#2E6BF6",short_symbol:"ANKR",decimals:18,display_decimals:8,show_fiat_decimals:!0},BAL={id:1007,name:"Balancer",symbol:"BAL",color:"#1E1E1E",short_symbol:"BAL",decimals:18,display_decimals:8,show_fiat_decimals:!0},COMP={id:1008,name:"Compound",symbol:"COMP",color:"#00D395",short_symbol:"COMP",decimals:18,display_decimals:8,show_fiat_decimals:!0},CRV={id:1009,name:"Curve DAO",symbol:"CRV",color:"#40649F",short_symbol:"CRV",decimals:18,display_decimals:8,show_fiat_decimals:!0},USDC={id:1010,name:"USD Coin",symbol:"USDC",color:"#3E73C4",short_symbol:"USDC",decimals:6,display_decimals:6,show_fiat_decimals:!0},DNT={id:1011,name:"district0x",symbol:"DNT",color:"#2C398F",short_symbol:"DNT",decimals:18,display_decimals:8,show_fiat_decimals:!0},GRT={id:1012,name:"The Graph",symbol:"GRT",color:"#5942CC",short_symbol:"GRT",decimals:18,display_decimals:8,show_fiat_decimals:!0},LINK={id:1013,name:"Chainlink",symbol:"LINK",color:"#2A5ADA",short_symbol:"LINK",decimals:18,display_decimals:8,show_fiat_decimals:!0},MANA={id:1014,name:"Decentraland",symbol:"MANA",color:"#FF2D55",short_symbol:"MANA",decimals:18,display_decimals:8,show_fiat_decimals:!0},MKR={id:1015,name:"Maker",symbol:"MKR",color:"#1AAB9B",short_symbol:"MKR",decimals:18,display_decimals:8,show_fiat_decimals:!0},OXT={id:1016,name:"Orchid",symbol:"OXT",color:"#5F45BA",short_symbol:"OXT",decimals:18,display_decimals:8,show_fiat_decimals:!0},REN={id:1017,name:"Ren",symbol:"REN",color:"#080817",short_symbol:"REN",decimals:18,display_decimals:8,show_fiat_decimals:!0},SNX={id:1018,name:"Synthetix",symbol:"SNX",color:"#5FCDF9",short_symbol:"SNX",decimals:18,display_decimals:8,show_fiat_decimals:!0},SUSHI={id:1019,name:"SushiSwap",symbol:"SUSHI",color:"#D65892",short_symbol:"SUSHI",decimals:18,display_decimals:8,show_fiat_decimals:!0},UMA={id:1020,name:"UMA",symbol:"UMA",color:"#FF4A4A",short_symbol:"UMA",decimals:18,display_decimals:8,show_fiat_decimals:!0},UNI={id:1021,name:"Uniswap",symbol:"UNI",color:"#FF007A",short_symbol:"UNI",decimals:18,display_decimals:8,show_fiat_decimals:!0},CVC={id:1022,name:"Civic",symbol:"CVC",color:"#3AB03E",short_symbol:"CVC",decimal:8,display_decimals:8,show_fiat_decimals:!0},XTZ={id:35,name:"Tezos",symbol:"XTZ",color:"#447BEF",short_symbol:"XTZ",decimal:6,display_decimals:6,show_fiat_decimals:!0};const series_provider_local=async(r,t,e)=>{const o=`?cryptocurrency_id=${r}&width=${t}&height=${e}`;return console.log("https://cors-anywhere.herokuapp.com/https://staging2.api.spotapp.tech/v1/aion/graphs"+o),fetch_crypto_series("https://cors-anywhere.herokuapp.com/https://staging2.api.spotapp.tech/v1/aion/graphs"+o)},series_provider_prod=async(r,t,e)=>{return fetch_crypto_series("https://spot.so/graphs"+`?cryptocurrency_id=${r}&width=${t}&height=${e}`)},fetch_crypto_series=async r=>{const t=await fetch(r).then((function(r){return r.ok?r.json():Promise.reject(r)})).catch((function(r){console.warn("Something went wrong.",r)}));return["1d","7d","1m","3m","1y","all"].map(r=>helios_graph_to_d3(t[r]))},data_provider=series_provider_prod;function GraphGradient(e,t){const i=e.append("defs").append("linearGradient").attr("id","linear-gradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");i.selectAll("stop").data(t).enter().append("stop").attr("offset",(function(e){return e.offset})).attr("stop-color",(function(e){return e.color}))}function PriceLabel(e,t,i,r){this.label=e.append("g").append("text"),this.show=(e,a)=>{this.label.html(priceFormat(e.price,r)).attr("x",t(e.date)+a.x).attr("y",i(e.price)+a.y).attr("visibility","visible")},this.hide=()=>{this.label.attr("visibility","hidden")}}function PointMouseOver(e,t,i,r,a,s){this.gradient_reader=new GradientReader(i),this.mouseover_info=document.getElementById("mouseover_info"),this.line=e.append("g").append("line").attr("id","mouse_over_line").style("stroke","#c1c8c7").style("stroke-width",2).style("opacity",1),this.dot=e.append("g").append("circle").attr("id","mouse_over_dot").style("opacity",0),this.mouse_layer_recovery=e.append("rect").attr("id","mouse_layer_recovery").style("fill","none").style("pointer-events","all").attr("width",t.width).attr("height",t.height),this.show=()=>{this.dot.attr("visibility","visible"),this.line.attr("visibility","visible")},this.update=(e,t,i)=>{this.dot.attr("visibility","hidden"),this.line.attr("visibility","hidden");const o=this.mouseover_info.querySelector("p#price-info"),n=this.mouseover_info.querySelector("span#price-value"),c=this.mouseover_info.querySelector("span#price-change"),l=Math.sign(e[0].price-e[e.length-1].price),d=Math.abs(e[0].price-e[e.length-1].price),p=(Math.abs(e[0].price-e[e.length-1].price)/e[0].price*100).toFixed(2);-1===l?(c.className="increase",c.innerHTML=`\u2191${priceFormat(d)} (+${p}%)`):(c.className="decrease",c.innerHTML=`\u2193${priceFormat(d)} (-${p}%)`);let h=document.getElementById("series_selector").getElementsByTagName("a")[CURRENT_SPOT_SERIE_IDX].innerHTML;5==CURRENT_SPOT_SERIE_IDX&&(h="all time"),void 0!=o.childNodes[2]&&o.childNodes[2].remove(),o.append(` since ${h}`),n.innerHTML=`${priceFormat(e[e.length-1].price,s)}`;const u=(()=>{dot=this.dot,line=this.line,mouseover_info=this.mouseover_info,gradient_reader=this.gradient_reader;const l=()=>{const l=r.invert(d3.mouse(this.mouse_layer_recovery._groups[0][0])[0]),d=bisect(e,l,1),p=e[d],h=get_price_pst(p,t,i),u=gradient_reader.getColor(h);dot.style("fill",`#${u}`).style("opacity",1).attr("cx",r(p.date)).attr("cy",a(p.price)),line.style("opacity",1).attr("x1",r(p.date)).attr("y1",a(t)).attr("x2",r(p.date)).attr("y2",a(i)),o.prepend(c),n.innerHTML=`${priceFormat(p.price,s)}`};return{mouseout:()=>{n.innerHTML=`${priceFormat(e[e.length-1].price,s)}`,this.dot.style("opacity",0),this.line.style("opacity",0)},mousemove:l,touchmove:l}})();this.mouse_layer_recovery.on("mouseover",u.mouseover).on("mouseout",u.mouseout).on("mousemove",u.mousemove).on("touchmove",u.touchmove)}}function BlinkingPoint(e,t,i,r){this.gradient_reader=new GradientReader(r),this.circles=[e.append("g").append("circle").attr("class","pulse-disk").attr("visibility","hidden"),e.append("g").append("circle").attr("class","pulse-circle").attr("stroke-width",2).attr("visibility","hidden"),e.append("g").append("circle").attr("class","pulse-circle-2").attr("stroke-width",2).attr("visibility","hidden")],this.show=(e,r,a)=>{const s=get_price_pst(e,r,a),o=this.gradient_reader.getColor(s);this.circles[0].style("fill",`#${o}`),this.circles[1].style("stroke",`#${o}`),this.circles[2].style("stroke",`#${o}`),this.circles.forEach(r=>{r.attr("cx",t(e.date)).attr("cy",i(e.price)).attr("visibility","visible")})},this.hide=()=>{this.circles.forEach(e=>e.attr("visibility","hidden"))}}const bisect=d3.bisector((function(e){return e.date})).left,get_price_pst=(e,t,i)=>{return 100*(e.price-t)/(i-t)},getNavigatorLanguage=()=>navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.userLanguage||navigator.language||navigator.browserLanguage||"en",priceFormat=(e,t)=>{return e.toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:t?2:0,maximumFractionDigits:t?2:0})};class SpotChart{constructor(t,i,e,s){this.chart_dimension={width:document.getElementById(t).clientWidth-i.left-i.right,height:document.getElementById(t).clientHeight-i.top-i.bottom},this.data_gradient=e,this.x=d3.scaleTime().range([0,this.chart_dimension.width]),this.y=d3.scaleLinear().range([this.chart_dimension.height,0]),this.xAxis=d3.axisBottom().scale(this.x),this.yAxis=d3.axisLeft().scale(this.y),this.svg=d3.select("#crypto-chart").append("svg").attr("width","100%").attr("height","100%").append("g").attr("transform","translate("+i.left+","+i.top+")"),this._init_components(s)}_init_components(t){this._linearGradient=new GraphGradient(this.svg,this.data_gradient),this._point_mouse_over=new PointMouseOver(this.svg,this.chart_dimension,this.data_gradient,this.x,this.y,t),this._min_price_label=new PriceLabel(this.svg,this.x,this.y,t),this._max_price_label=new PriceLabel(this.svg,this.x,this.y,t),this._blinking_point=new BlinkingPoint(this.svg,this.x,this.y,this.data_gradient)}draw(t){const i=d3.minIndex(t,t=>t.price),e=d3.maxIndex(t,t=>t.price),s=t[i].price,n=t[e].price,a=t[t.length-1];get_price_pst(a,s,n);this.x.domain(d3.extent(t,(function(t){return t.date}))),this.y.domain([s,n]);const h=this.svg.selectAll(".line").data([t]),r=d3.line().curve(d3.curveCatmullRom.alpha(.25)).x(t=>{return this.x(t.date)}).y(t=>{return this.y(t.price)});h.enter().append("path").attr("class","line").merge(h).transition().duration(1500).attr("d",r).attr("fill","none").style("stroke","url(#linear-gradient)").on("start",()=>{this._point_mouse_over.update(t,s,n),this._min_price_label.hide(),this._max_price_label.hide(),this._blinking_point.hide()}).on("end",()=>{this._point_mouse_over.show(),this._min_price_label.show(t[i],{x:-30,y:25}),this._max_price_label.show(t[e],{x:-30,y:-25}),this._blinking_point.show(a,s,n)})}}function helios_graph_to_d3(t){const i=[],e=t.end_timestamp-t.start_timestamp,s=e/t.prices.length;t.prices.forEach((function(t){t.time=new Date(1e3*t.time)}));for(var n=0;n<t.prices.length;n++){let e=n*s+t.start_timestamp;i.push({price:t.prices[n],date:new Date(1e3*e)})}return i}var domIsReady=function(e){const o=function(){return document.attachEvent&&"undefined"!==typeof document.attachEvent?"ie":"not-ie"};return e=function(e){e&&"function"===typeof e?"ie"!==o()?document.addEventListener("DOMContentLoaded",(function(){return e()})):document.attachEvent("onreadystatechange",(function(){if("complete"===document.readyState)return e()})):console.error("The callback is not a function!")},e}(domIsReady||{});const MOBILE_WIDTH=767;let CURRENT_SPOT_SERIE_IDX=5;function get_crypto_from_url(){const e=window.location,o="file:"===e.protocol,r=o?e.href:e.pathname;return-1!==r.search("bitcoin-price")||"/chart"===r?BTC:-1!==r.search("ethereum-price")?ETH:-1!==r.search("dai-price")?DAI:-1!==r.search("basic-attention-token-price")?BAT:-1!==r.search("kyber-network-price")?KNC:-1!==r.search("omg-network-price")?OMG:-1!==r.search("0x-price")?ZRX:-1!==r.search("aave-price")?AAVE:-1!==r.search("ankr-price")?ANKR:-1!==r.search("balancer-price")?BAL:-1!==r.search("compound-price")?COMP:-1!==r.search("curve-dao-price")?CRV:-1!==r.search("usdcoin-price")?USDC:-1!==r.search("district0x-price")?DNT:-1!==r.search("the-graph-price")?GRT:-1!==r.search("chainlink-price")?LINK:-1!==r.search("decentraland-price")?MANA:-1!==r.search("maker-price")?MKR:-1!==r.search("orchid-price")?OXT:-1!==r.search("ren-price")?REN:-1!==r.search("synthetix-price")?SNX:-1!==r.search("sushiswap-price")?SUSHI:-1!==r.search("uma-price")?UMA:-1!==r.search("uniswap-price")?UNI:-1!==r.search("civic-price")?CVC:-1!==r.search("tezos")?XTZ:BTC}const run=async()=>{const e=get_crypto_from_url(),o=[{offset:"0%",color:e.color},{offset:"12.5%",color:e.color},{offset:"20%",color:e.color},{offset:"25%",color:e.color},{offset:"30%",color:e.color},{offset:"50%",color:e.color},{offset:"60%",color:e.color},{offset:"70%",color:e.color},{offset:"75%",color:e.color},{offset:"80%",color:e.color},{offset:"87.5%",color:e.color},{offset:"100%",color:e.color}],r=["1 day","7 days","1 month","3 months","1 year","all"],c=["24h","7d","1m","3m","1y","all"],t={top:50,right:20,bottom:50,left:20},n=screen.width,a=screen.height,i=document.getElementById("series_selector"),s=i.getElementsByTagName("a");n>MOBILE_WIDTH?[...s].forEach((e,o)=>e.innerHTML=r[o]):[...s].forEach((e,o)=>e.innerHTML=c[o]);const h=await data_provider(e.id,n,a);document.getElementById("chart-loader").remove();const l=new SpotChart("crypto-chart",t,o,e.show_fiat_decimals);if(i.childElementCount!=h.length)throw"Number of button and series does not match";let d;function f(){document.getElementById("crypto-chart").firstElementChild.remove(),h.forEach((o,r)=>s[r].onclick=()=>{CURRENT_SPOT_SERIE_IDX=r,e.draw(o)});const e=new SpotChart("crypto-chart",t,o);e.draw(h[CURRENT_SPOT_SERIE_IDX])}h.forEach((e,o)=>s[o].onclick=()=>{CURRENT_SPOT_SERIE_IDX=o,l.draw(e)}),l.draw(h[CURRENT_SPOT_SERIE_IDX]),window.onresize=()=>{clearTimeout(d),d=setTimeout(f,25)}};(function(e,o,r,c){r(run)})(document,window,domIsReady);
